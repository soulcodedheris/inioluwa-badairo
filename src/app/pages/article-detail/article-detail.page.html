<section class="mx-auto min-h-dvh w-full max-w-6xl px-6 py-12">
  <app-breadcrumbs />
  <div class="fixed inset-x-0 top-0 z-40 h-0.5 bg-transparent">
    <div id="read-progress" class="h-full w-0 bg-gray-900 transition-[width] dark:bg-white"></div>
  </div>
  <a id="back-to-articles" routerLink="/articles" class="fixed right-4 top-20 z-30 hidden rounded-full border border-gray-300 bg-white/80 px-3 py-1 text-xs text-gray-800 backdrop-blur hover:bg-white dark:border-gray-700 dark:bg-black/60 dark:text-gray-100">← Back to articles</a>
  <a routerLink="/articles" class="text-sm text-gray-600 hover:text-gray-900">← Back to articles</a>

  @if (article(); as art) {
    <header class="mt-4">
      <div class="flex flex-wrap items-center gap-3">
        <h1 class="text-3xl font-semibold sm:text-5xl">{{ art.title }}</h1>
        @if ((art.status || '').toLowerCase() === 'draft') {
          <span class="rounded-full border border-amber-400 bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700 dark:border-amber-800 dark:bg-amber-950/40 dark:text-amber-300">Draft</span>
        }
      </div>
      <p class="mt-2 text-sm text-gray-500">{{ art.date | date }} · {{ readMins() }} min read</p>
      <div class="mt-3 flex items-center gap-2">
        <button class="rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-zinc-800" (click)="copyUrl()">Copy link</button>
        @if (copied()) {
          <span class="text-xs text-green-600" role="status" aria-live="polite">Copied</span>
        }
        <a [href]="twitterShareUrl" target="_blank" rel="noopener" class="rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-zinc-800">Twitter</a>
        <a [href]="linkedinShareUrl" target="_blank" rel="noopener" class="rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-zinc-800">LinkedIn</a>
      </div>
    </header>

    <div class="mt-8 grid grid-cols-1 gap-8 md:grid-cols-[1.15fr_260px]">
      <article id="article-content" class="prose-custom" [innerHTML]="safeHtml()"></article>
      @if (related().length) {
      <section class="mt-8 space-y-3">
        <h2 class="text-xl font-semibold">Keep reading</h2>
        <ul class="space-y-1 text-sm text-gray-600 dark:text-gray-300">
          @for (r of related(); track r.slug) {
            <li>
              <a [routerLink]="['/articles', r.slug]" class="underline">{{ r.title }}</a>
            </li>
          }
        </ul>
        <a routerLink="/articles" class="inline-block rounded border border-gray-300 px-3 py-1 text-xs hover:bg-gray-100 dark:border-gray-700 dark:hover:bg-zinc-800">Browse all articles →</a>
      </section>
      }
      <nav class="toc-card hidden self-start md:block">
        <p class="text-xs uppercase tracking-widest text-gray-500">On this page</p>
        <ul class="mt-3 space-y-2">
          @for (item of toc(); track item.id) {
            <li>
              <a [href]="'#' + item.id" class="block rounded px-1.5 py-0.5 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-zinc-800 dark:hover:text-white" [ngClass]="{ 'bg-gray-100 text-gray-900 dark:bg-zinc-800 dark:text-white': item.id === activeTocId() }">{{ item.text }}</a>
            </li>
          }
        </ul>
      </nav>
    </div>
  } @else {
    <p class="mt-8 text-gray-600">Article not found.</p>
  }
</section>


